<script>
let batch = 1;

async function loadData() {
  try {
    const r = await fetch(`/market-pulse-v2?batch=${batch}`);
    const res = await r.json();

    let rows = "";

    res.data.forEach(x => {
      let pulseBadge =
        x.pulse === "STRONG" ? "ðŸŸ¢ STRONG" :
        x.pulse === "MEDIUM" ? "ðŸŸ¡ MEDIUM" :
        "ðŸ”´ WEAK";

      rows += `
        <tr>
          <td>${x.symbol}</td>
          <td>${x.signal}</td>
          <td>${x.price_change_pct}%</td>
          <td>${x.vwap_delta}</td>
          <td>${x.imbalance}</td>
          <td>${x.r_factor}</td>
          <td>${pulseBadge}</td>
        </tr>
      `;
    });

    document.getElementById("data").innerHTML = rows;

    batch++;
    if (batch > res.total_batches) batch = 1;

  } catch (err) {
    console.error("Dashboard error:", err);
  }
}

loadData();
setInterval(loadData, 10000);
</script>
